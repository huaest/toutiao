{"remainingRequest":"/Users/yanmaohua/Desktop/toutiao/toutiao/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yanmaohua/Desktop/toutiao/toutiao/src/views/home/components/PopoUp.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yanmaohua/Desktop/toutiao/toutiao/src/views/home/components/PopoUp.vue","mtime":1632126128047},{"path":"/Users/yanmaohua/Desktop/toutiao/toutiao/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yanmaohua/Desktop/toutiao/toutiao/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/yanmaohua/Desktop/toutiao/toutiao/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yanmaohua/Desktop/toutiao/toutiao/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IHNldEl0ZW0gfSBmcm9tICdAL3V0aWxzL3N0b3JhZ2UuanMnCmltcG9ydCB7IG1hcFN0YXRlIH0gZnJvbSAndnVleCcKZXhwb3J0IGRlZmF1bHQgewogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBhbGxDaGFubmVsczogW10sCiAgICAgIGlzRWRpdDogZmFsc2UsCiAgICAgIGZpeENoYW5uZWxzOiBbMF0KICAgIH0KICB9LAogIHByb3BzOiB7CiAgICBjaGFubmVsczogewogICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgdHlwZTogQXJyYXkKICAgIH0sCiAgICBhY3RpdmU6IHsKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgIHR5cGU6IE51bWJlcgogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcFN0YXRlKFsndXNlciddKSwKICAgIC8vICAg5Zug5Li66KaB5pe25Yi755uR5ZCs55So5oi355qE6YCJ5oup77yM5omA5Lul6KaB55So6K6h566X5bGe5oCn77yB77yB77yBCiAgICBjb21wdXRlQ2hhbm5lbHMoKSB7CiAgICAgIGNvbnN0IG5ld0NoYW5uZWxzID0gW10KICAgICAgdGhpcy5hbGxDaGFubmVscy5mb3JFYWNoKChjaGFubmVsKSA9PiB7CiAgICAgICAgLy8gICDmib7liLDnrKblkIjmnaHku7bnmoTlhYPntKAKICAgICAgICBjb25zdCByZXMgPSB0aGlzLmNoYW5uZWxzLmZpbmQoKG15KSA9PiB7CiAgICAgICAgICByZXR1cm4gbXkuaWQgPT09IGNoYW5uZWwuaWQKICAgICAgICB9KQogICAgICAgIGlmICghcmVzKSB7CiAgICAgICAgICBuZXdDaGFubmVscy5wdXNoKGNoYW5uZWwpCiAgICAgICAgfQogICAgICB9KQogICAgICByZXR1cm4gbmV3Q2hhbm5lbHMKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIC8vICAg5omA5pyJ6aKR6YGT6K+35rGC5qih5Z2XCiAgICBhc3luYyBnZXRDaGFubmVscygpIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCB7IGRhdGE6IHJlcyB9ID0gYXdhaXQgdGhpcy4kYXhpb3MuZ2V0KCd2MV8wL2NoYW5uZWxzJykKICAgICAgICB0aGlzLmFsbENoYW5uZWxzID0gcmVzLmRhdGEuY2hhbm5lbHMKICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgdGhpcy4kdG9hc3QuZmFpbCgn6I635Y+W5YiX6KGo5aSx6LSlJykKICAgICAgfQogICAgfSwKICAgIGFzeW5jIGFkZEl0ZW0oaXRlbSkgewogICAgICBpZiAodGhpcy5pc0VkaXQgPT09IHRydWUpIHsKICAgICAgICB0aGlzLmNoYW5uZWxzLnB1c2goaXRlbSkKICAgICAgICBpZiAodGhpcy51c2VyKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICAvLyAgIOavj+a3u+WKoOS4gOS4quWPkemAgeivt+axggogICAgICAgICAgICBhd2FpdCB0aGlzLiRheGlvcy5wYXRjaCgndjFfMC91c2VyL2NoYW5uZWxzJywgewogICAgICAgICAgICAgIGNoYW5uZWxzOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGlkOiBpdGVtLmlkLAogICAgICAgICAgICAgICAgICBzZXE6IHRoaXMuY2hhbm5lbHMubGVuZ3RoCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgXQogICAgICAgICAgICB9KQogICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIHRoaXMuJHRvYXN0LmZhaWwoJ+aVsOaNruS/neWtmOWksei0pScpCiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNldEl0ZW0oJ2xvY2FsLWNoYW5uZWwnLCB0aGlzLmNoYW5uZWxzKQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGVkaXQoKSB7CiAgICAgIHRoaXMuaXNFZGl0ID0gIXRoaXMuaXNFZGl0CiAgICB9LAogICAgLy8g5Y+q6YCC55So5LqO54i25a2Q57uE5Lu25Lyg5YC877yB77yBCiAgICBjaGFuZ2VDaGFubmVsKGNoYW5uZWwsIGluZGV4KSB7CiAgICAgIGlmICghdGhpcy5pc0VkaXQpIHsKICAgICAgICB0aGlzLiRlbWl0KCdjaGFubmVsLWNoYW5nZScsIGluZGV4LCBmYWxzZSkKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyAgIOWbuuWumuS4jeiDveWIoOmZpOeahOaVsOaNrgogICAgICAgIGlmICh0aGlzLmZpeENoYW5uZWxzLmluY2x1ZGVzKGNoYW5uZWwuaWQpKSB7CiAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICAgICAgaWYgKGluZGV4IDw9IHRoaXMuYWN0aXZlKSB7CiAgICAgICAgICB0aGlzLiRlbWl0KCdjaGFubmVsLWNoYW5nZScsIHRoaXMuYWN0aXZlIC0gMSwgdHJ1ZSkKICAgICAgICB9CiAgICAgICAgLy8g5pWw57uE55qE5Yig6Zmk5pON5L2c77yM5piv5a+55Y6f5pWw57uE55qE5pON5L2c77yB77yB77yBCiAgICAgICAgdGhpcy5jaGFubmVscy5zcGxpY2UoaW5kZXgsIDEpCiAgICAgICAgaWYgKHRoaXMudXNlcikgewogICAgICAgICAgdGhpcy5kZWxldGVDaGFubmVsKGNoYW5uZWwpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNldEl0ZW0oJ2xvY2FsLWNoYW5uZWwnLCB0aGlzLmNoYW5uZWxzKQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGFzeW5jIGRlbGV0ZUNoYW5uZWwoY2hhbm5lbCkgewogICAgICBpZiAodGhpcy51c2VyKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGF3YWl0IHRoaXMuJGF4aW9zLmRlbGV0ZShgdjFfMC91c2VyL2NoYW5uZWxzLyR7Y2hhbm5lbC5pZH1gKQogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgdGhpcy4kdG9hc3QuZmFpbCgn5pWw5o2u5a2Y5YKo5aSx6LSlJykKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgIH0KICAgIH0KICB9LAogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmdldENoYW5uZWxzKCkKICB9Cn0K"},{"version":3,"sources":["PopoUp.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PopoUp.vue","sourceRoot":"src/views/home/components","sourcesContent":["<template>\n  <div class=\"channel-edit\">\n    <van-cell class=\"cell\">\n      <div slot=\"title\">我的频道</div>\n      <van-button type=\"primary\" size=\"mini\" round @click=\"edit\">{{\n        isEdit ? '完成' : '编辑'\n      }}</van-button>\n    </van-cell>\n    <van-grid :gutter=\"10\" class=\"delete-edit\">\n      <van-grid-item\n        class=\"grid-item\"\n        v-for=\"(value, index) in channels\"\n        :key=\"index\"\n        icon=\"clear\"\n        @click=\"changeChannel(value, index)\"\n      >\n        <van-icon\n          slot=\"icon\"\n          name=\"clear\"\n          v-show=\"isEdit && !fixChannels.includes(value.id)\"\n        ></van-icon>\n        <span slot=\"text\" class=\"text\" :class=\"{ active: index === active }\">{{\n          value.name\n        }}</span>\n      </van-grid-item>\n    </van-grid>\n    <!-- 频道推荐 -->\n    <van-cell class=\"cell\">\n      <div slot=\"title\">频道推荐</div>\n    </van-cell>\n    <van-grid :gutter=\"10\" class=\"commend-edit\">\n      <van-grid-item\n        class=\"grid-item\"\n        v-for=\"value in computeChannels\"\n        :key=\"value.id\"\n        :text=\"value.name\"\n        @click=\"addItem(value)\"\n      >\n        <van-icon slot=\"icon\" name=\"plus\" v-show=\"isEdit === true\"></van-icon>\n      </van-grid-item>\n    </van-grid>\n  </div>\n</template>\n\n<script>\nimport { setItem } from '@/utils/storage.js'\nimport { mapState } from 'vuex'\nexport default {\n  data() {\n    return {\n      allChannels: [],\n      isEdit: false,\n      fixChannels: [0]\n    }\n  },\n  props: {\n    channels: {\n      required: true,\n      type: Array\n    },\n    active: {\n      required: true,\n      type: Number\n    }\n  },\n  computed: {\n    ...mapState(['user']),\n    //   因为要时刻监听用户的选择，所以要用计算属性！！！\n    computeChannels() {\n      const newChannels = []\n      this.allChannels.forEach((channel) => {\n        //   找到符合条件的元素\n        const res = this.channels.find((my) => {\n          return my.id === channel.id\n        })\n        if (!res) {\n          newChannels.push(channel)\n        }\n      })\n      return newChannels\n    }\n  },\n  methods: {\n    //   所有频道请求模块\n    async getChannels() {\n      try {\n        const { data: res } = await this.$axios.get('v1_0/channels')\n        this.allChannels = res.data.channels\n      } catch (err) {\n        this.$toast.fail('获取列表失败')\n      }\n    },\n    async addItem(item) {\n      if (this.isEdit === true) {\n        this.channels.push(item)\n        if (this.user) {\n          try {\n            //   每添加一个发送请求\n            await this.$axios.patch('v1_0/user/channels', {\n              channels: [\n                {\n                  id: item.id,\n                  seq: this.channels.length\n                }\n              ]\n            })\n          } catch (err) {\n            this.$toast.fail('数据保存失败')\n          }\n        } else {\n          setItem('local-channel', this.channels)\n        }\n      }\n    },\n    edit() {\n      this.isEdit = !this.isEdit\n    },\n    // 只适用于父子组件传值！！\n    changeChannel(channel, index) {\n      if (!this.isEdit) {\n        this.$emit('channel-change', index, false)\n      } else {\n        //   固定不能删除的数据\n        if (this.fixChannels.includes(channel.id)) {\n          return\n        }\n        if (index <= this.active) {\n          this.$emit('channel-change', this.active - 1, true)\n        }\n        // 数组的删除操作，是对原数组的操作！！！\n        this.channels.splice(index, 1)\n        if (this.user) {\n          this.deleteChannel(channel)\n        } else {\n          setItem('local-channel', this.channels)\n        }\n      }\n    },\n    async deleteChannel(channel) {\n      if (this.user) {\n        try {\n          await this.$axios.delete(`v1_0/user/channels/${channel.id}`)\n        } catch (err) {\n          this.$toast.fail('数据存储失败')\n        }\n      } else {\n      }\n    }\n  },\n  created() {\n    this.getChannels()\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.channel-edit {\n  padding: 85px 0;\n}\n.delete-edit {\n  /deep/ .grid-item {\n    width: 160px;\n    height: 86px;\n    .van-grid-item__content {\n      white-space: nowrap;\n      background-color: #f4f5f6;\n      flex-direction: row;\n      font-size: 28px;\n      .van-grid-item__icon-wrapper {\n        position: unset;\n      }\n      .van-icon-clear {\n        position: absolute;\n        right: -10px;\n        top: -10px;\n        font-size: 30px;\n        z-index: 2;\n      }\n      .van-grid-item__text,\n      .text {\n        font-size: 25px;\n        margin-top: 10px;\n      }\n    }\n  }\n}\n.commend-edit {\n  /deep/ .grid-item {\n    width: 160px;\n    height: 86px;\n    .van-grid-item__content {\n      white-space: nowrap;\n      overflow: hidden;\n      background-color: #f4f5f6;\n      flex-direction: row;\n      font-size: 28px;\n      .van-icon {\n        font-size: 24px;\n      }\n      .van-grid-item__text {\n        margin-top: 10px;\n      }\n    }\n  }\n}\n\n.active {\n  color: red;\n}\n</style>\n"]}]}